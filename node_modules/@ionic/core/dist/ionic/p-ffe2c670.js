/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */
import{g as o,c as t,f as n}from"./p-f321535c.js";import{a as i,b as r,r as a,c as e}from"./p-38bc7b29.js";import{a as s,K as c}from"./p-d7fd994b.js";import"./p-e1bc9a81.js";import"./p-627e74b4.js";import"./p-3c349187.js";const d=new WeakMap,l=(o,t,n,i=0,r=!1)=>{d.has(o)!==n&&(n?u(o,t,i,r):f(o,t))},u=(o,t,n,i=!1)=>{const r=t.parentNode,a=t.cloneNode(!1);a.classList.add("cloned-input"),a.tabIndex=-1,i&&(a.disabled=!0),r.appendChild(a),d.set(o,a);const e="rtl"===o.ownerDocument.dir?9999:-9999;o.style.pointerEvents="none",t.style.transform=`translate3d(${e}px,${n}px,0) scale(0)`},f=(o,t)=>{const n=d.get(o);n&&(d.delete(o),n.remove()),o.style.pointerEvents="",t.style.transform=""},p="input, textarea, [no-blur], [contenteditable]",w="$ionPaddingTimer",m=(o,t,n)=>{const i=o[w];i&&clearTimeout(i),t>0?o.style.setProperty("--keyboard-offset",`${t}px`):o[w]=setTimeout((()=>{o.style.setProperty("--keyboard-offset","0px"),n&&n()}),120)},b=(o,t,n)=>{o.addEventListener("focusout",(()=>{t&&m(t,0,n)}),{once:!0})};let h=0;const y="data-ionic-skip-scroll-assist",S=o=>{document.activeElement!==o&&(o.setAttribute(y,"true"),o.focus())},M=async(n,i,r,e,s,c,d=!1)=>{if(!r&&!e)return;const u=((o,t,n)=>{var i;return((o,t,n,i)=>{const r=o.top,a=o.bottom,e=t.top,s=e+15,c=Math.min(t.bottom,i-n)-50-a,d=s-r,l=Math.round(c<0?-c:d>0?-d:0),u=Math.min(l,r-e),f=Math.abs(u);return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,f/.3)),scrollPadding:n,inputSafeY:4-(r-s)}})((null!==(i=o.closest("ion-item,[ion-item]"))&&void 0!==i?i:o).getBoundingClientRect(),t.getBoundingClientRect(),n,o.ownerDocument.defaultView.innerHeight)})(n,r||e,s);if(r&&Math.abs(u.scrollAmount)<4)return S(i),void(c&&null!==r&&(m(r,h),b(i,r,(()=>h=0))));if(l(n,i,!0,u.inputSafeY,d),S(i),a((()=>n.click())),c&&r&&(h=u.scrollPadding,m(r,h)),"undefined"!=typeof window){let a;const e=async()=>{void 0!==a&&clearTimeout(a),window.removeEventListener("ionKeyboardDidShow",s),window.removeEventListener("ionKeyboardDidShow",e),r&&await t(r,0,u.scrollAmount,u.scrollDuration),l(n,i,!1,u.inputSafeY),S(i),c&&b(i,r,(()=>h=0))},s=()=>{window.removeEventListener("ionKeyboardDidShow",s),window.addEventListener("ionKeyboardDidShow",e)};if(r){const t=await o(r);if(u.scrollAmount>t.scrollHeight-t.clientHeight-t.scrollTop)return"password"===i.type?(u.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",s)):window.addEventListener("ionKeyboardDidShow",e),void(a=setTimeout(e,1e3))}e()}},D=async(o,t)=>{const a=document,d="ios"===t,u="android"===t,f=o.getNumber("keyboardHeight",290),w=o.getBoolean("scrollAssist",!0),m=o.getBoolean("hideCaretOnScroll",d),b=o.getBoolean("inputBlurring",d),h=o.getBoolean("scrollPadding",!0),S=Array.from(a.querySelectorAll("ion-input, ion-textarea")),D=new WeakMap,v=new WeakMap,x=await c.getResizeMode(),k=async o=>{await new Promise((t=>e(o,t)));const t=o.shadowRoot||o,a=t.querySelector("input")||t.querySelector("textarea"),c=n(o),d=c?null:o.closest("ion-footer");if(a){if(c&&m&&!D.has(o)){const t=((o,t,n)=>{if(!n||!t)return()=>{};const a=n=>{var i;(i=t)===i.getRootNode().activeElement&&l(o,t,n)},e=()=>l(o,t,!1),s=()=>a(!0),c=()=>a(!1);return i(n,"ionScrollStart",s),i(n,"ionScrollEnd",c),t.addEventListener("blur",e),()=>{r(n,"ionScrollStart",s),r(n,"ionScrollEnd",c),t.removeEventListener("blur",e)}})(o,a,c);D.set(o,t)}if("date"!==a.type&&"datetime-local"!==a.type&&(c||d)&&w&&!v.has(o)){const t=((o,t,n,i,r,a,e,c=!1)=>{const d=a&&(void 0===e||e.mode===s.None),l=async()=>{t.hasAttribute(y)?t.removeAttribute(y):M(o,t,n,i,r,d,c)};return o.addEventListener("focusin",l,!0),()=>{o.removeEventListener("focusin",l,!0)}})(o,a,c,d,f,h,x,u);v.set(o,t)}}};b&&(()=>{let o=!0,t=!1;const n=document;i(n,"ionScrollStart",(()=>{t=!0})),n.addEventListener("focusin",(()=>{o=!0}),!0),n.addEventListener("touchend",(i=>{if(t)return void(t=!1);const r=n.activeElement;if(!r)return;if(r.matches(p))return;const a=i.target;a!==r&&(a.matches(p)||a.closest(p)||(o=!1,setTimeout((()=>{o||r.blur()}),50)))}),!1)})();for(const o of S)k(o);a.addEventListener("ionInputDidLoad",(o=>{k(o.detail)})),a.addEventListener("ionInputDidUnload",(o=>{(o=>{if(m){const t=D.get(o);t&&t(),D.delete(o)}if(w){const t=v.get(o);t&&t(),v.delete(o)}})(o.detail)}))};export{D as startInputShims}